<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>NexusNet Chat</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 0; }
    #app { display: grid; grid-template-rows: 1fr auto; height: 100vh; }
    #log { padding: 16px; overflow-y: auto; }
    #bar { display: flex; gap: 8px; padding: 8px; border-top: 1px solid #ccc; }
    #bar input { flex: 1; padding: 8px; }
  </style>
</head>
<body>
<div id="app">
  <div id="log"></div>
  <div id="bar">
    <input id="text" placeholder="Type message..." />
    <button id="send">Send</button>
  </div>
</div>
<script>
const log = document.getElementById('log');
const input = document.getElementById('text');
const btn = document.getElementById('send');
const sessionId = localStorage.getItem('nn_session') || crypto.randomUUID();
localStorage.setItem('nn_session', sessionId);

function add(role, content) {
  const div = document.createElement('div');
  div.textContent = role.toUpperCase()+": "+content;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

btn.onclick = async () => {
  const content = input.value.trim();
  if (!content) return;
  add('user', content);
  input.value = '';
  const payload = {
    session_id: sessionId,
    messages: [{role:'user', content}]
  };
  const res = await fetch('/chat', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  add('assistant', data.reply + "  [expert="+data.expert+" backend="+data.backend+"]");
};
</script>
</body>
</html>
